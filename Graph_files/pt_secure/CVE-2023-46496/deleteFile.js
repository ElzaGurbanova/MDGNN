const v37 = require('path');
const join = v37.join;
const v38 = require('fs');
const existsSync = v38.existsSync;
const unlinkSync = v38.unlinkSync;
const lstatSync = v38.lstatSync;
const v39 = require('@evershop/evershop/src/lib/helpers');
const CONSTANTS = v39.CONSTANTS;
const v40 = require('@evershop/evershop/src/lib/util/httpStatus');
const INVALID_PAYLOAD = v40.INVALID_PAYLOAD;
const OK = v40.OK;
const v72 = (request, response, delegate, next) => {
    const v41 = request.params;
    const v42 = v41[0];
    const path = v42 || '';
    const v43 = /^(?!(\/|\.{2,}\/))[a-zA-Z0-9_\-/]*\.[a-zA-Z0-9_\-]+$/.test(path);
    const v44 = v43 === false;
    if (v44) {
        const v45 = response.status(INVALID_PAYLOAD);
        const v46 = {};
        v46.status = INVALID_PAYLOAD;
        v46.message = 'Invalid path';
        const v47 = { error: v46 };
        const v48 = v45.json(v47);
        v48;
        return;
    }
    const v49 = CONSTANTS.MEDIAPATH;
    const v50 = join(v49, path);
    const v51 = existsSync(v50);
    const v52 = !v51;
    if (v52) {
        const v53 = response.status(INVALID_PAYLOAD);
        const v54 = {};
        v54.status = INVALID_PAYLOAD;
        v54.message = 'Requested path does not exist';
        const v55 = { error: v54 };
        const v56 = v53.json(v55);
        v56;
    } else {
        const v57 = CONSTANTS.MEDIAPATH;
        const v58 = join(v57, path);
        const v59 = lstatSync(v58);
        const v60 = v59.isDirectory();
        if (v60) {
            const v61 = response.status(INVALID_PAYLOAD);
            const v62 = {};
            v62.status = INVALID_PAYLOAD;
            v62.message = 'Requested path is not a file';
            const v63 = { error: v62 };
            const v64 = v61.json(v63);
            v64;
        } else {
            const v65 = CONSTANTS.MEDIAPATH;
            const v66 = join(v65, path);
            const v67 = unlinkSync(v66);
            v67;
            const v68 = response.status(OK);
            const v69 = {};
            v69.path = path;
            const v70 = { data: v69 };
            const v71 = v68.json(v70);
            v71;
        }
    }
};
module.exports = v72;